import{p as t,P as e}from"./phaser-DgVbYced.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class s extends t.Scene{constructor(){super("Boot")}preload(){this.load.image("pre_background","assets/bg_main.png")}create(){this.scene.start("Preloader")}}class a extends t.Scene{constructor(){super("GameOver")}create(){this.cameras.main.setBackgroundColor(16711680),this.add.image(512,384,"background").setAlpha(.5),this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}class i extends t.Scene{constructor(){super("MainMenu")}create(){this.add.text(0,0,"",{fontFamily:"stardust-extrabold",fontSize:"20px"}),this.add.text(0,0,"",{fontFamily:"stardust-bold",fontSize:"20px"}),this.add.text(0,0,"",{fontFamily:"stardust",fontSize:"20px"}),this.add.image(960,540,"pre_background").setScale(10),this.time.delayedCall(200,(()=>{this.scene.start("Battle")})),this.scene.transition({target:"Battle",duration:1e3,moveBelow:!0,onUpdate:t=>{this.cameras.main.setAlpha(1-t)}})}}class r extends t.Scene{constructor(){super("Preloader")}init(){this.add.image(960,540,"pre_background").setScale(10),this.add.rectangle(960,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(730,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){const t=document.createElement("style");t.innerHTML='\n          @font-face {\n            font-family: "stardust-extrabold";\n            src: url("assets/fonts/PF스타더스트 3.0 ExtraBold.ttf") format("truetype");\n          }\n          @font-face {\n            font-family: "stardust-bold";\n            src: url("assets/fonts/PF스타더스트 3.0 Bold.ttf") format("truetype");\n          }\n          @font-face {\n            font-family: "stardust";\n            src: url("assets/fonts/PF스타더스트 3.0.ttf") format("truetype");\n          }\n        ',document.head.appendChild(t),this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("background","bg.png"),this.load.image("inventory","bg_inventory.png"),this.load.spritesheet("hero_idle","hero_idle.png",{frameWidth:480,frameHeight:320}),this.load.spritesheet("hero_run","hero_run.png",{frameWidth:480,frameHeight:320}),this.load.spritesheet("hero_attack","hero_attack.png",{frameWidth:480,frameHeight:320}),this.load.spritesheet("hero_attack_double","hero_attack_double.png",{frameWidth:480,frameHeight:320}),this.load.spritesheet("hero_death","hero_death.png",{frameWidth:480,frameHeight:320}),this.load.spritesheet("bee_idle","bee_idle.png",{frameWidth:192,frameHeight:192}),this.load.spritesheet("bee_attack","bee_attack.png",{frameWidth:192,frameHeight:192}),this.load.spritesheet("bee_hit","bee_hit.png",{frameWidth:192,frameHeight:192}),this.load.spritesheet("bee_death","bee_death.png",{frameWidth:192,frameHeight:192}),this.load.spritesheet("slot","bg_slots.png",{frameWidth:120,frameHeight:120}),this.load.spritesheet("equipment","icon_equipments.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("potion","icon_potions.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("x","icon_x.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("pause","icon_pause.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("ball","icon_balls.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("auto","icon_autos.png",{frameWidth:120,frameHeight:120})}create(){this.anims.create({key:"hero_idle",frames:this.anims.generateFrameNumbers("hero_idle",{start:0,end:9}),frameRate:12,repeat:-1}),this.anims.create({key:"hero_run",frames:this.anims.generateFrameNumbers("hero_run",{start:0,end:9}),frameRate:12,repeat:-1}),this.anims.create({key:"hero_attack",frames:this.anims.generateFrameNumbers("hero_attack",{start:0,end:3}),frameRate:12,repeat:0}),this.anims.create({key:"hero_attack_double",frames:this.anims.generateFrameNumbers("hero_attack_double",{start:0,end:9}),frameRate:12,repeat:0}),this.anims.create({key:"hero_death",frames:this.anims.generateFrameNumbers("hero_death",{start:0,end:9}),frameRate:12,repeat:0}),this.anims.create({key:"bee_idle",frames:this.anims.generateFrameNumbers("bee_idle",{start:0,end:3}),frameRate:12,repeat:-1}),this.anims.create({key:"bee_attack",frames:this.anims.generateFrameNumbers("bee_attack",{start:0,end:3}),frameRate:12,repeat:0}),this.anims.create({key:"bee_hit",frames:this.anims.generateFrameNumbers("bee_hit",{start:0,end:3}),frameRate:12,repeat:0}),this.anims.create({key:"bee_death",frames:this.anims.generateFrameNumbers("bee_death",{start:0,end:3}),frameRate:8,repeat:0});const t=this.make.renderTexture({width:360,height:480,add:!1});t.drawFrame("slot",1,0,0),t.drawFrame("slot",2,120,0),t.drawFrame("slot",3,240,0),t.drawFrame("slot",0,0,120),t.drawFrame("slot",5,120,120),t.drawFrame("slot",7,240,120),t.drawFrame("slot",5,0,240),t.drawFrame("slot",16,120,240),t.drawFrame("slot",11,240,240),t.drawFrame("slot",13,0,360),t.drawFrame("slot",14,120,360),t.drawFrame("slot",15,240,360),t.saveTexture("itemInfoBack");const e=this.make.renderTexture({width:720,height:120,add:!1});e.drawFrame("slot",1,0,0),e.drawFrame("slot",2,120,0),e.drawFrame("slot",2,240,0),e.drawFrame("slot",2,360,0),e.drawFrame("slot",2,480,0),e.drawFrame("slot",3,600,0),e.saveTexture("dropRateBack");const s=this.make.renderTexture({width:720,height:360,add:!1});s.drawFrame("slot",5,0,0),s.drawFrame("slot",6,120,0),s.drawFrame("slot",6,240,0),s.drawFrame("slot",6,360,0),s.drawFrame("slot",6,480,0),s.drawFrame("slot",7,600,0),s.drawFrame("slot",9,0,120),s.drawFrame("slot",10,120,120),s.drawFrame("slot",10,240,120),s.drawFrame("slot",10,360,120),s.drawFrame("slot",10,480,120),s.drawFrame("slot",11,600,120),s.drawFrame("slot",13,0,240),s.drawFrame("slot",14,120,240),s.drawFrame("slot",14,240,240),s.drawFrame("slot",14,360,240),s.drawFrame("slot",14,480,240),s.drawFrame("slot",15,600,240),s.saveTexture("allStatBack");const a=this.make.renderTexture({width:360,height:120,add:!1});a.drawFrame("slot",1,0,0),a.drawFrame("slot",2,120,0),a.drawFrame("slot",3,240,0),a.saveTexture("confirmBack");const i=this.make.renderTexture({width:240,height:360,add:!1});i.drawFrame("slot",23,0,0),i.drawFrame("slot",22,120,0),i.drawFrame("slot",8,0,120),i.drawFrame("slot",8,120,120),i.drawFrame("slot",21,0,240),i.drawFrame("slot",20,120,240),i.saveTexture("dequeBack"),this.scene.transition({target:"MainMenu",duration:1e3,moveBelow:!0,onUpdate:t=>{this.cameras.main.setAlpha(1-t)}})}}class h extends Phaser.GameObjects.Container{constructor(t,e,s){super(t,e,s),this.width=120,this.height=24,this.backgroundBar=t.add.graphics(),this.backgroundBar.fillStyle(2105376),this.backgroundBar.fillRect(0,0,this.width,this.height),this.foregroundBar=t.add.graphics(),this.foregroundBar.fillStyle(15597568),this.foregroundBar.fillRect(0,0,this.width,this.height),this.healthText=t.add.text(this.width/2,this.height/2,"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add(this.backgroundBar),this.add(this.foregroundBar),this.add(this.healthText),t.add.existing(this)}updateHealth(t,e){const s=Phaser.Math.Clamp(t/e,0,1);this.foregroundBar.clear(),this.foregroundBar.fillStyle(15597568),this.foregroundBar.fillRect(0,0,this.width*s,this.height),this.healthText.setText(`${Math.ceil(t)}/${e}`)}}function o(t,e){return Math.round(t*10**e)/10**e}class n extends Phaser.GameObjects.Text{constructor(t,e,s,a,i="#ffffff",r=!0){super(t,e,s,a,{fontFamily:"stardust-extrabold",fontSize:"22px",color:i}),this.scene=t,this.scene.add.existing(this),this.setOrigin(.5,.5),this.moveUp=r,this.duration=1e3,this.startY=s,this.endY=r?s-50:s+50,this.scene.tweens.add({targets:this,alpha:{from:1,to:0},y:this.endY,duration:this.duration,ease:"Cubic.Out",onComplete:()=>{this.destroy()}})}}class l extends Phaser.GameObjects.Text{constructor(t,e,s,a,i="#ffffff",r=!0){super(t,e,s,a,{fontFamily:"stardust-extrabold",fontSize:"22px",color:i}),this.scene=t,this.scene.add.existing(this),this.setOrigin(.5,.5),this.startX=e,this.startY=s,this.jumpHeight=50,this.duration=800,this.scene.tweens.add({targets:this,x:{from:this.startX,to:this.startX+(r?60:-60)},y:{from:this.startY,to:this.startY,ease:"Linear"},alpha:{from:1,to:0},duration:this.duration,ease:"Linear",onUpdate:(t,e)=>{const s=t.progress;e.y=this.startY-this.jumpHeight*(1-Math.pow(2*s-1,2))},onComplete:()=>{this.destroy()}})}}class d extends e.GameObjects.Sprite{constructor(t,e,s,a,i,r){super(t,e,s,a),this.scene.add.existing(this);const[o,n,l]=function(){const t=Math.random(),e=Math.random(),s=Math.random(),a=t+e+s;return[t/a,e/a,s/a]}(),d={maxHealth:Math.round(5*r*(1+o)),attackDamage:Math.round(1*r*(1+n)),attackSpeed:Math.round(100*(.4+l))/100};this.name=i,this.scene=t,this.maxHealth=d.maxHealth,this.health=d.maxHealth,this.level=r,this.attackDamage=d.attackDamage,this.attackSpeedModifier=d.attackSpeed,this.attackDelay=1e3,this.attackTimer=0,this.isAlive=!0,this.healthBar=new h(t,this.x-50,this.y+200).setDepth(-2),this.levelText=t.add.text(this.x-50,this.y+180,`Lv.${r}`,{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(-2)}initialize(){this.play(`${this.name}_idle`),this.setAttackDelay(),this.scene.tweens.add({targets:this,x:720,y:180,duration:1e3,ease:"Linear",onComplete:()=>{this.scene.startBattle()}}),this.healthBar.updateHealth(this.health,this.maxHealth)}setAttackDelay(){if(0==this.attackSpeedModifier)return 100;this.attackDelay=1e3/this.attackSpeedModifier}attack(t){this.isAlive&&(this.play(`${this.name}_attack`),this.once(`animationcomplete-${this.name}_attack`,(()=>this.play(`${this.name}_idle`))),t.takeDamage(this.attackDamage))}takeDamage(t){if(!this.isAlive)return;let e=Math.min(this.health,t);return this.health-=t,this.setTint(13369344),this.scene.time.delayedCall(150,(()=>{this.clearTint()})),this.health<=0&&(this.health=0,this.die()),new l(this.scene,this.x+40,this.y,`${o(t,0)}`,"#ff0000"),this.healthBar.updateHealth(this.health,this.maxHealth),e}die(){this.isAlive=!1,this.scene.tweens.add({targets:this,alpha:0,duration:400,ease:"Linear",onStart:()=>{this.play(`${this.name}_death`)},onComplete:()=>{this.destroy()}}),this.scene.handleEnemyDeath(this)}update(){this.healthBar.x=this.x-50,this.levelText.x=this.x+10}destroy(){this.healthBar&&(this.healthBar.destroy(),this.healthBar=null),this.levelText&&(this.levelText.destroy(),this.levelText=null),super.destroy()}}class m extends Phaser.GameObjects.Container{constructor(t,e,s){super(t,e,s),this.width=120,this.height=24,this.backgroundBar=t.add.graphics(),this.backgroundBar.fillStyle(2105376),this.backgroundBar.fillRect(0,0,this.width,this.height),this.foregroundBar=t.add.graphics(),this.foregroundBar.fillStyle(3403315),this.foregroundBar.fillRect(0,0,this.width,this.height),this.expText=t.add.text(this.width/2,this.height/2,"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add(this.backgroundBar),this.add(this.foregroundBar),this.add(this.expText),t.add.existing(this)}updateExpBar(t,e){const s=Phaser.Math.Clamp(t/e,0,1);this.foregroundBar.clear(),this.foregroundBar.fillStyle(3403315),this.foregroundBar.fillRect(0,0,this.width*s,this.height),this.expText.setText(`${Math.ceil(t)}/${e}`)}}class c extends e.GameObjects.Sprite{constructor(t,e,s,a){super(t,e,s,a),this.scene.add.existing(this),this.name="player",this.scene=t,this.status={maxHealth:25,attackDamage:0,attackSpeed:1},this.health=25,this.level=1,this.exp=0,this.maxExp=3,this.gold=0,this.isFirstAttack=!1,this.secondDelay=1e3,this.secondTimer=0,this.attackDelay=1e3,this.attackTimer=0,this.isAlive=!0,this.healthBar=new h(t,this.x-70,this.y+200),this.expBar=new m(t,this.x-70,this.y+230),this.levelText=t.add.text(this.x-10,this.y+180,`Lv.${this.level}`,{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.equipments={sword:{itemType:"sword",itemName:"검",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["공격력 +5"],statRarities:["common"],options:{}},helmet:{itemType:"helmet",itemName:"투구",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["최대 HP +5"],statRarities:["common"],options:{}},breastplate:{itemType:"breastplate",itemName:"흉갑",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["최대 HP +5"],statRarities:["common"],options:{}},leggings:{itemType:"leggings",itemName:"레깅스",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["최대 HP +5"],statRarities:["common"],options:{}},gloves:{itemType:"gloves",itemName:"장갑",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["최대 HP +5"],statRarities:["common"],options:{}},boots:{itemType:"boots",itemName:"부츠",rarity:"common",itemLevel:1,refined:0,mainValue:5,statTexts:["최대 HP +5"],statRarities:["common"],options:{}}}}initialize(){this.setPlayerStat(),this.play("hero_idle"),this.setAttackDelay(),this.move(),this.expBar.updateExpBar(this.exp,this.maxExp)}setPlayerStat(){const t=this.health/this.status.maxHealth;this.status={maxHealth:0,attackDamage:0,attackSpeed:1},Object.values(this.equipments).forEach((t=>{"sword"===t.itemType?this.status.attackDamage+=t.mainValue:this.status.maxHealth+=t.mainValue;for(const[e,s]of Object.entries(t.options))void 0===this.status[e]&&(this.status[e]=0),this.status[e]+=s})),console.log(this.status),this.setHealth(Math.round(this.status.maxHealth*t)),this.setAttackDelay()}changeItem(t){this.equipments[t.itemType]=t,this.setPlayerStat()}setAttackDelay(){if(0==this.status.attackSpeed)return 100;this.attackDelay=1e3/this.status.attackSpeed}move(){this.play("hero_run")}attack(t){if(!this.isAlive)return;let e=this.status.attackDamage;this.status.battleCry&&this.isFirstAttack&&(e*=1+this.status.battleCry/100);let s=2;this.status.criticalDamage&&(s*=1+this.status.criticalDamage/100),this.status.criticalChance&&this.status.criticalChance/100<Math.random()&&(e*=s),this.play("hero_attack"),this.once("animationcomplete-hero_attack",(()=>this.play("hero_idle")));const a=t.takeDamage(e);this.isFirstAttack=!1,this.status.leech&&this.changeHealth(a*this.status.leech/100)}takeDamage(t){if(!this.isAlive)return 0;this.status.dodge&&this.status.dodge/100<Math.random()&&new l(this.scene,this.x-40,this.y+60,"회피","#ffffff",!1);let e=t;this.status.flatArmor&&(e=Math.max(e-this.status.flatArmor,0)),e>0&&(this.setTint(13369344),this.scene.time.delayedCall(150,(()=>{this.clearTint()}))),this.changeHealth(-e)}changeHealth(t){this.health=Math.max(Math.min(this.health+t,this.status.maxHealth),0),this.health<=0&&(this.health=0,this.die()),this.healthBar.updateHealth(this.health,this.status.maxHealth),new l(this.scene,this.x-40,this.y+60,`${o(t>0?t:-t,2)}`,t>0?"#00ff00":t="#ff0000",!1)}setHealth(t){this.health=Math.max(Math.min(t,this.status.maxHealth),0),this.health<=0&&(this.health=0,this.die()),this.healthBar.updateHealth(this.health,this.status.maxHealth)}earnExp(t){this.exp+=t,this.exp>=this.maxExp&&(this.level++,this.levelText.setText(`Lv.${this.level}`),new n(this.scene,this.x,this.y,"Lv UP","#00ff00"),this.exp-=this.maxExp,this.maxExp=Math.floor(1.3**(this.level-1)*3+2*this.level),this.setHealth(this.status.maxHealth),this.scene.changeDropRate(1)),this.expBar.updateExpBar(this.exp,this.maxExp)}die(){this.isAlive=!1,this.play("hero_death"),this.scene.handlePlayerDeath()}update(t,e){this.status.regeneration&&(this.secondTimer+=e,this.secondTimer>=this.secondDelay&&(this.changeHealth(this.status.regeneration),this.secondTimer=0))}destroy(){this.healthBar&&(this.healthBar.destroy(),this.healthBar=null),super.destroy()}}const f={attackDamage:{text:"공격력",prefixes:["헤라클레스의","시련을 극복한","결의의","용맹한","전투"],minValue:3,maxValue:15,sizeUnderFloat:0},maxHealth:{text:"최대 HP",prefixes:["포세이돈의","심해 아래","바다의","포용하는","호신"],minValue:5,maxValue:25,sizeUnderFloat:0},attackSpeed:{text:"공격속도",prefixes:["헤르메스의","돌풍을 업은","신속의","날렵한","경량화"],minValue:.04,maxValue:.2,sizeUnderFloat:2},criticalChance:{text:"치명타 확률(%)",prefixes:["아프로디테의","고혹적인","매혹의","치명적인","가시"],minValue:2,maxValue:10,sizeUnderFloat:0},criticalDamage:{text:"치명타 피해 증가(%)",prefixes:["아레스의","광기에 물든","살육의","잔인한","전쟁"],minValue:4,maxValue:20,sizeUnderFloat:0},flatArmor:{text:"고정 피해 감소",prefixes:["헤파이스토스의","벼려진","불굴의","강인한","강철"],minValue:2,maxValue:10,sizeUnderFloat:0},leech:{text:"흡혈(%)",prefixes:["백작의","갈망하는","흡혈의","목마른","혈석"],minValue:2,maxValue:10,sizeUnderFloat:1},goldBonus:{text:"처치 시 골드",prefixes:["미다스의","사치스러운","욕망의","화려한","황금"],minValue:1,maxValue:10,sizeUnderFloat:0},expBonus:{text:"처치 시 경험치",prefixes:["아테나의","자애로운","통찰의","지혜로운","비취"],minValue:1,maxValue:10,sizeUnderFloat:0},battleCry:{text:"첫 공격 강화(%)",prefixes:["제우스의","번개같은","찰나의","맹렬한","돌격"],minValue:4,maxValue:20,sizeUnderFloat:0},regeneration:{text:"초당 회복량",prefixes:["위그드라실의","뿌리 내린","신록의","살아숨쉬는","생목"],minValue:2,maxValue:10,sizeUnderFloat:2},dodge:{text:"회피율(%)",prefixes:["하데스의","어둠이 드리운","밤의","고요한","흑요석"],minValue:4,maxValue:8,sizeUnderFloat:2}},u={common:"일반",uncommon:"고급",rare:"희귀",epic:"영웅",mythic:"전설"},p={common:0,uncommon:1,rare:2,epic:3,mythic:4},x=Object.fromEntries(Object.entries(p).map((([t,e])=>[e,t]))),g={common:"#ffffff",uncommon:"#1eff00",rare:"#368aff",epic:"#e822ff",mythic:"#ff8000"},y={sword:0,helmet:1,breastplate:2,leggings:3,gloves:4,boots:5},T=Object.fromEntries(Object.entries(y).map((([t,e])=>[e,t]))),k={common:.75,uncommon:1,rare:1.25,epic:1.8,mythic:2.5};function b(t,e){const s=Object.keys(f),a=s[Math.floor(Math.random()*s.length)],i=f[a],r=o(k[e]*(i.minValue+Math.random()*(i.maxValue-i.minValue)),i.sizeUnderFloat),h=`${i.text} +${r}`,n=i.maxValue*k.mythic;let l="common";l=r<n/5?"common":r<2*n/5?"uncommon":r<3*n/5?"rare":r<4*n/5?"epic":"mythic";const d=i.prefixes[4-t];return{[a]:r,prefix:d,statText:h,statRarity:l}}class w extends e.GameObjects.Container{constructor(t,e,s,a=null,i=()=>{},r=!1){super(t,e,s),this.scene.add.existing(this),this.scene=t,this.itemData=a,this.onItemSelect=i,this.background=t.add.image(0,0,"itemInfoBack").setOrigin(0).setInteractive(),this.add(this.background);let h=!1;this.background.on("pointerdown",(()=>{h=!0,r||this.background.setTint(11184810)})),this.background.on("pointerup",(()=>{h&&this.onItemSelect(),h=!1,this.background.clearTint()})),this.background.on("pointerout",(()=>{h=!1,this.background.clearTint()})),this.itemNameText=t.add.text(180,60,"",{fontFamily:"stardust-extrabold",fontSize:"28px",color:"#ffffff",align:"center",wordWrap:{width:340}}).setOrigin(.5),this.itemIcon=t.add.image(60,180,"").setScale(1).setVisible(!1),this.rarityText=t.add.text(160,160,"",{fontFamily:"stardust-extrabold",fontSize:"22px",color:"#ffffff",align:"left"}),this.levelText=t.add.text(160,190,"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"left"}),this.statText0=t.add.text(160,220,"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"left"}),this.statTexts=[];for(let o=1;o<=5;o++){const e=t.add.text(40,280+35*(o-1),"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"left"});this.statTexts.push(e)}this.add([this.itemNameText,this.itemIcon,this.rarityText,this.levelText,this.statText0,...this.statTexts]),this.updateUI(a)}updateUI(t=null,e=null,s=null){if(this.itemNameText.setText(""),this.itemIcon.setTexture("x"),this.rarityText.setText(""),this.levelText.setText(""),this.statText0.setText(""),this.statTexts.forEach((t=>t.setText(""))),t){this.itemNameText.setText(`${t.itemName}${t.refined?`(+${t.refined})`:""}`).setColor(g[t.rarity]),this.itemIcon.setTexture("equipment",y[t.itemType]).setVisible(!0),e&&this.itemIcon.setTexture(e,s).setVisible(!0),this.rarityText.setText(u[t.rarity]).setColor(g[t.rarity]),this.levelText.setText(`Lv.${t.itemLevel} ${t.refined?`(+${t.refined})`:""}`),this.statText0.setText(t.statTexts[0]||"").setColor(g[t.statRarities[0]||"common"]||t.statRarities[0]);for(let e=1;e<=5;e++){const s=t.statTexts[e]||"",a=t.statRarities[e]||"common",i=g[a];this.statTexts[e-1].setText(s).setColor(i).setVisible(""!==s)}}}}class I extends Phaser.GameObjects.Container{constructor(t,e,s,a){super(t,e,s),this.scene=t,this.dropRate=a,t.add.image(e,s,"dropRateBack"),this.dropRateTexts={},this.createDropRateUI(),t.add.existing(this)}createDropRateUI(){let t=0;Object.keys(this.dropRate).forEach((e=>{const s=100*this.dropRate[e],a=this.scene.add.text(120*t-240,-10,u[e],{fontFamily:"stardust-extrabold",fontSize:"22px",color:g[e]}).setOrigin(.5,.5),i=this.scene.add.text(120*t-240,15,`${this.formatRate(s)}%`,{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff"}).setOrigin(.5,.5);this.add(a),this.add(i),this.dropRateTexts[e]=i,t++}))}formatRate(t){return Number.isInteger(t)?t.toFixed(0):10*t%1==0?t.toFixed(1):t.toFixed(2)}updateUI(t){this.dropRate=t,Object.keys(this.dropRate).forEach((t=>{const e=100*this.dropRate[t];this.dropRateTexts[t].setText(`${this.formatRate(e)}%`)}))}}class F{constructor(){this.items=[],this.head=0,this.tail=0}enqueue(t){this.items[this.tail]=t,this.tail++}dequeue(){if(this.isEmpty())return null;const t=this.items[this.head];return this.head++,this.head>100&&2*this.head>this.tail&&(this.items=this.items.slice(this.head,this.tail),this.tail-=this.head,this.head=0),t}peek(){return this.isEmpty()?null:this.items[this.head]}showcase(t){return this.items.slice(this.head,Math.min(this.head+t,this.tail))}isEmpty(){return this.head===this.tail}}class v extends e.GameObjects.Container{constructor(t,e,s,a={}){super(t,e,s),this.scene.add.existing(this),this.scene=t,t.add.text(e,660,"전체 능력치",{fontFamily:"stardust-extrabold",fontSize:"24px",color:"#ffffff"}).setOrigin(.5,.5),this.background=t.add.image(e,870,"allStatBack").setOrigin(.5,.5),this.statTexts=[];for(let i=0;i<21;i++){const e=t.add.text(1120+220*Math.floor(i/7),730+i%7*35,"",{fontFamily:"stardust-extrabold",fontSize:"20px",color:"#ffffff",align:"left"});this.statTexts.push(e)}this.updateUI(a)}updateUI(t={}){this.statTexts.forEach((t=>t.setText(""))),t&&Object.entries(t).forEach((([t,e],s)=>{this.statTexts[s].setText(`${f[t].text}: ${o(e,f[t].sizeUnderFloat)}`)}))}}const B=[{itemType:"potion",itemName:"소형 포션",rarity:"uncommon",itemLevel:10,refined:0,mainValue:10,statTexts:["소모품","구매 즉시 체력 회복 +10"],statRarities:["common","uncommon"],options:{}},{itemType:"potion",itemName:"중형 포션",rarity:"rare",itemLevel:75,refined:0,mainValue:100,statTexts:["소모품","구매 즉시 체력 회복 +100"],statRarities:["common","rare"],options:{}},{itemType:"potion",itemName:"대형 포션",rarity:"epic",itemLevel:500,refined:0,mainValue:1e3,statTexts:["소모품","구매 즉시 체력 회복 +1000"],statRarities:["common","epic"],options:{}}],S=[{itemType:"auto",itemName:"일반 장비 자동 판매",rarity:"common",itemLevel:1e3,refined:0,mainValue:0,statTexts:["소모품","구매 이후 일반 등급 자동 판매"],statRarities:["common","common"],options:{}},{itemType:"auto",itemName:"고급 장비 자동 판매",rarity:"uncommon",itemLevel:1e4,refined:0,mainValue:0,statTexts:["소모품","구매 이후 고급 등급 자동 판매"],statRarities:["common","uncommon"],options:{}},{itemType:"auto",itemName:"희귀 장비 자동 판매",rarity:"rare",itemLevel:1e5,refined:0,mainValue:0,statTexts:["소모품","구매 이후 희귀 등급 자동 판매"],statRarities:["common","rare"],options:{}}];class R extends t.Scene{constructor(){super("Battle")}create(){this.isBattle=!1,this.enemy=null,this.enemyKilled=0,this.gold=0,this.add.image(480,540,"background").setDepth(-9),this.add.image(1440,540,"inventory").setDepth(-1),this.player=new c(this,240,120,"hero_idle").setDepth(-2),this.player.initialize(),this.spawnEnemy(),this.pauseButton=this.add.image(920,343,"slot").setScale(.5).setInteractive(),this.pauseIcon=this.add.image(920,343,"pause",0).setScale(.5),this.isPaused=!1,this.pauseButton.on("pointerdown",(()=>{this.isPaused=!this.isPaused,this.pauseIcon.setTexture("pause",this.isPaused+0)})),this.itemQueue=new F,this.nextItems=[],this.autoEnabled=[!1,!1,!1,!1,!1],this.dropRate={common:1,uncommon:.1,rare:.01,epic:.001,mythic:1e-4},this.dropRateUI=new I(this,600,990,this.dropRate),this.leftItem=null,this.rightItem=null,this.selectedItem=null,this.add.text(420,420,"획득한 장비 / 클릭하여 교체",{fontFamily:"stardust-bold",fontSize:"28px",color:"#ffffff"}).setOrigin(.5,.5),this.add.text(780,420,"내 장비 / 클릭하여 유지",{fontFamily:"stardust-bold",fontSize:"28px",color:"#ffffff"}).setOrigin(.5,.5),this.add.text(120,990," 화살표를 눌러\n등급별 확률 변경",{fontFamily:"stardust-bold",fontSize:"28px",color:"#ffffff"}).setOrigin(.5,.5),this.leftItemUI=new w(this,240,450,null,(()=>this.handleItemSelect(!0))),this.rightItemUI=new w(this,600,450,null,(()=>this.handleItemSelect(!1))),this.selectedItemUI=new w(this,1080,150,null,(()=>{}),!0).setDepth(2),this.add.text(1620,435,"보유 골드",{fontFamily:"stardust-extrabold",fontSize:"24px",color:"#ffffff"}).setOrigin(.5,.5),this.goldText=this.add.text(1620,470,"0 G",{fontFamily:"stardust-extrabold",fontSize:"24px",color:"#ffff00"}).setOrigin(.5,.5),this.confirmButton=this.add.image(1620,570,"confirmBack").setInteractive(),this.confirmText1=this.add.text(1620,555,"",{fontFamily:"stardust-extrabold",fontSize:"22px",color:"#ffffff"}).setOrigin(.5,.5),this.confirmText2=this.add.text(1620,585,"",{fontFamily:"stardust-extrabold",fontSize:"22px",color:"#ffff00"}).setOrigin(.5,.5);let t=!1;this.confirmButton.on("pointerdown",(()=>{t=!0,this.confirmButton.setTint(11184810)})),this.confirmButton.on("pointerup",(()=>{t&&this.handleConfirm(this.selectedItem),t=!1,this.confirmButton.clearTint()})),this.confirmButton.on("pointerout",(()=>{t=!1,this.confirmButton.clearTint()}));const e=this.add.group();for(let i=0;i<6;i++){const t=this.add.image(1140+120*i,90,"slot",0).setInteractive();this.add.image(1140+120*i,90,"equipment",i);const s=T[i];t.on("pointerdown",(()=>{e.children.iterate((t=>{t.clearTint()})),t.setTint(11184810),this.selectedItem=this.player.equipments[s],this.selectedItemUI.updateUI(this.selectedItem),this.confirmText1.setText(`+${this.selectedItem.refined} > +${this.selectedItem.refined+1} 강화`),this.confirmText2.setText(2**this.selectedItem.refined*10+" G")})),e.add(t)}for(let i=0;i<3;i++){const t=this.add.image(1140+120*(i+3),210,"slot",0).setInteractive();this.add.image(1140+120*(i+3),210,"potion",i),t.on("pointerdown",(()=>{e.children.iterate((t=>{t.clearTint()})),t.setTint(11184810),this.selectedItem=B[i],this.selectedItemUI.updateUI(this.selectedItem,"potion",i),this.confirmText1.setText("구매 및 사용"),this.confirmText2.setText(`${this.selectedItem.itemLevel} G`)})),e.add(t)}for(let i=0;i<3;i++){const t=this.add.image(1140+120*(i+3),330,"slot",0).setInteractive();this.add.text(1140+120*(i+3),315,u[x[i]],{fontFamily:"stardust-bold",fontSize:"24px",color:g[x[i]]}).setOrigin(.5,.5),this.add.text(1140+120*(i+3),345,"자동 판매",{fontFamily:"stardust-bold",fontSize:"24px",color:"#ffffff"}).setOrigin(.5,.5),t.on("pointerdown",(()=>{e.children.iterate((t=>{t.clearTint()})),t.setTint(11184810),this.selectedItem=S[i],this.selectedItemUI.updateUI(this.selectedItem,"auto",i),this.confirmText1.setText("구매 및 적용"),this.confirmText2.setText(`${this.selectedItem.itemLevel} G`)})),e.add(t)}const s=this.add.text(360,1030,"",{fontFamily:"stardust-extrabold",fontSize:"22px",color:"#ff0000"}).setOrigin(.5,.5),a=this.add.text(480,1030,"",{fontFamily:"stardust-extrabold",fontSize:"22px",color:"#00ff00"}).setOrigin(.5,.5);for(let i=0;i<4;i++){const t=this.add.image(420+120*i,990,"pause",1).setScale(.25).setInteractive();t.on("pointerover",(()=>{t.setTint(11184810),s.x=360+120*i,s.setText(`-${10**(2-i)}%`).setVisible(!0),a.x=360+120*(i+1),a.setText(`+${10**(1-i)}%`).setVisible(!0)})),t.on("pointerout",(()=>{t.clearTint(),s.setVisible(!1),a.setVisible(!1)})),t.on("pointerdown",(()=>{this.elevateDropRate(i)}))}this.allStat=new v(this,1440,650),this.allStat.updateUI(this.player.status)}update(t,e){this.enemy&&this.enemy.update(),this.player&&this.player.update(t,e),this.isBattle&&!this.isPaused&&(this.player.attackTimer+=e,this.enemy.attackTimer+=e,this.player.attackTimer>=this.player.attackDelay&&(this.player.attack(this.enemy),this.player.attackTimer=0),this.enemy.attackTimer>=this.enemy.attackDelay&&(this.enemy.attack(this.player),this.enemy.attackTimer=0))}spawnEnemy(){let t=Math.ceil((this.enemyKilled+1)/4);this.enemyKilled%10==9&&(t+=5),this.enemy=new d(this,1200,120,"bee_idle","bee",t).setDepth(-2),this.enemy.initialize()}startBattle(){this.isBattle=!0,this.player.isFirstAttack=!0,this.player.attackTimer=this.player.attackDelay,this.enemy.attackTimer=this.enemy.attackDelay/2}handleEnemyDeath(){this.isBattle=!1,this.enemyKilled++;let t=this.enemy.level;this.player.status.expBonus&&(t+=this.player.status.expBonus),this.player.earnExp(t);let e=this.enemy.level;this.player.status.goldBonus&&(e+=this.player.status.goldBonus),this.earnGold(e),new n(this,720,150,`+${e} G`,"#ffff00"),this.spawnEnemy(),this.player.once("animationcomplete-hero_attack",(()=>this.player.move())),this.handleItemDrop()}handlePlayerDeath(){this.isBattle=!1,this.gameOverText1=this.add.text(480,200,"Game Over",{fontFamily:"stardust-extrabold",fontSize:"60px",color:"#ffffff"}).setOrigin(.5,.5).setInteractive(),this.gameOverText2=this.add.text(480,250,"Click Here to Restart",{fontFamily:"stardust-extrabold",fontSize:"30px",color:"#ffffff"}).setOrigin(.5,.5).setInteractive(),this.gameOverText1.once("pointerdown",(()=>{this.scene.start("MainMenu")})),this.gameOverText2.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}handleItemDrop(){Object.keys(this.dropRate).forEach((t=>{const e=this.dropRate[t],s=Math.floor(e),a=e%1;for(let i=0;i<s;i++)this.itemQueue.enqueue({rarity:t,level:this.player.level});Math.random()<a&&this.itemQueue.enqueue({rarity:t,level:this.player.level})})),this.leftItem||this.updateItem()}handleItemSelect(t){if(this.leftItem&&this.player.isAlive){if(t)this.player.changeItem(this.leftItem),this.selectedItem&&this.leftItem.itemType===this.selectedItem.itemType&&(this.selectedItem=this.leftItem,this.selectedItemUI.updateUI(this.leftItem)),this.allStat.updateUI(this.player.status);else{let t=10**p[this.leftItem.rarity];this.earnGold(t),new n(this,420,500,`+${t} G`,"#ffff00")}this.updateItem()}}updateItem(){if(this.itemQueue.isEmpty())this.leftItem=null;else{const{rarity:t,level:e}=this.itemQueue.dequeue();if(this.autoEnabled[p[t]]){let e=10**p[t];return this.earnGold(e),new n(this,420,500,`+${e} G`,"#ffff00"),this.updateItem()}this.leftItem=function(t,e){const s=T[Math.floor(6*Math.random())],a=Math.round(e*(5+2*Math.random())*k[t]),i={itemType:s,itemName:"",rarity:t,itemLevel:e,refined:0,mainValue:a,statTexts:[],statRarities:["common"],options:{}};"sword"==s?(i.itemName="검",i.statTexts.push(`공격력 +${a}`)):"helmet"==s?(i.itemName="투구",i.statTexts.push(`최대 HP +${a}`)):"breastplate"==s?(i.itemName="흉갑",i.statTexts.push(`최대 HP +${a}`)):"leggings"==s?(i.itemName="레깅스",i.statTexts.push(`최대 HP +${a}`)):"gloves"==s?(i.itemName="장갑",i.statTexts.push(`최대 HP +${a}`)):"boots"==s&&(i.itemName="부츠",i.statTexts.push(`최대 HP +${a}`));let r=0;const h=Math.random();switch(t){case"common":default:r=Math.round(h);break;case"uncommon":r=Math.floor(h+1.2);break;case"rare":r=Math.floor(h+1.7);break;case"epic":r=Math.floor(h+2.7);break;case"mythic":r=Math.floor(h+4.2)}for(let o=0;o<r;o++){const{prefix:e,statText:s,statRarity:a,...r}=b(o,t);for(const[t,h]of Object.entries(r))i.options[t]=(i.options[t]||0)+h;i.itemName=0==o?e+i.itemName:e+" "+i.itemName,i.statTexts.push(s),i.statRarities.push(a)}return i}(t,e)}this.leftItem?this.rightItem=this.player.equipments[this.leftItem.itemType]||null:this.rightItem=null,this.leftItemUI.updateUI(this.leftItem),this.rightItemUI.updateUI(this.rightItem)}handleConfirm(t){if(t&&this.player.isAlive)if("potion"===t.itemType){const e=t.itemLevel;this.gold>=e?(this.earnGold(-e),new n(this,1620,560,`-${e} G`,"#ff4444"),this.player.changeHealth(t.mainValue)):new n(this,1620,560,"골드 부족","#ff4444")}else if("auto"===t.itemType){const e=t.itemLevel;this.gold>=e?(this.earnGold(-e),new n(this,1620,560,`-${e} G`,"#ff4444"),this.autoEnabled[p[t.rarity]]=!0):new n(this,1620,560,"골드 부족","#ff4444")}else{const e=2**t.refined*10;this.gold>=e?(this.earnGold(-e),new n(this,1620,560,`-${e} G`,"#ff4444"),this.selectedItem=function(t){const e=t,s=Math.round((5+2*Math.random())*k[t.rarity]),a="#ff"+Math.max(15-t.refined,0).toString(16).repeat(4);return e.refined++,e.mainValue+=s,e.statTexts[0]=t.statTexts[0].replace(/(\+\d+)/,`+${e.mainValue}`),e.statRarities[0]=a,console.log(e),e}(t),this.player.changeItem(this.selectedItem),this.selectedItemUI.updateUI(this.selectedItem),this.allStat.updateUI(this.player.status),this.confirmText1.setText(`+${this.selectedItem.refined} > +${this.selectedItem.refined+1} 강화`),this.confirmText2.setText(2**this.selectedItem.refined*10+" G")):new n(this,1620,560,"골드 부족","#ff4444")}}earnGold(t){this.gold+=t,this.goldText.setText(`${this.gold} G`)}changeDropRate(t){this.dropRate.common+=t,this.dropRate.uncommon=Math.round(10*(this.dropRate.uncommon+t/10))/10,this.dropRate.rare=Math.round(100*(this.dropRate.rare+t/100))/100,this.dropRate.epic=Math.round(1e3*(this.dropRate.epic+t/1e3))/1e3,this.dropRate.mythic=Math.round(1e4*(this.dropRate.mythic+t/1e4))/1e4,this.dropRateUI.updateUI(this.dropRate)}elevateDropRate(t){this.dropRate[x[t]]<1/10**t||(this.dropRate[x[t]]=o(this.dropRate[x[t]]-1/10**t,t),this.dropRate[x[t+1]]=o(this.dropRate[x[t+1]]+1/10**(t+1),t+1),this.dropRateUI.updateUI(this.dropRate))}}const _={type:Phaser.AUTO,width:1920,height:1080,parent:"game-container",backgroundColor:"#028af8",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[s,r,i,R,a],defaultTextStyle:{fontFamily:"stardust",color:"#ffffff",stroke:"#000000",strokeThickness:3}};new Phaser.Game(_);
